<!-- <xml version="1.0"> -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <meta name="generator" content=
  "HTML Tidy for Cygwin (vers 1st September 2004), see www.w3.org" />

  <title>Shell utilities</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="generator" content="Org-mode" />
  <meta name="author" content="Fabrice Niessen" />
  <link rel="stylesheet" type="text/css" href=
  "http://www.pirilampo.org/styles/bigblow/css/htmlize.css" />
  <link rel="stylesheet" type="text/css" href=
  "http://www.pirilampo.org/styles/bigblow/css/bigblow.css" />
  <link rel="stylesheet" type="text/css" href=
  "http://www.pirilampo.org/styles/bigblow/css/hideshow.css" />
<script type="text/javascript" src=
"http://www.pirilampo.org/styles/bigblow/js/jquery-1.9.1.min.js">
</script>
<script type="text/javascript" src=
"http://www.pirilampo.org/styles/bigblow/js/jquery-ui-1.10.2.min.js">
</script>
<script type="text/javascript" src=
"http://www.pirilampo.org/styles/bigblow/js/jquery.localscroll-min.js">
</script>
<script type="text/javascript" src=
"http://www.pirilampo.org/styles/bigblow/js/jquery.scrollTo-1.4.3.1-min.js">
</script>
<script type="text/javascript" src=
"http://www.pirilampo.org/styles/bigblow/js/bigblow.js">
</script>
<script type="text/javascript" src=
"http://www.pirilampo.org/styles/bigblow/js/hideshow.js">
</script>
</head>

<body>
  <div id="content">
    <h1 class="title">Shell utilities</h1>

    <div id="table-of-contents">
      <h2>Table of Contents</h2>

      <div id="text-table-of-contents">
        <ul>
          <li>
            <a href="#sec-1">1. Context</a>

            <ul>
              <li><a href="#sec-1-1">1.1. Description</a></li>

              <li><a href="#sec-1-2">1.2. See also</a></li>

              <li><a href="#sec-1-3">1.3. Prerequisites</a></li>
            </ul>
          </li>

          <li>
            <a href="#sec-2">2. Shell functions</a>

            <ul>
              <li><a href="#sec-2-1">2.1. Exit with an error</a></li>

              <li><a href="#sec-2-2">2.2. Find the name of the parent
              process</a></li>
            </ul>
          </li>

          <li>
            <a href="#sec-3">3. Shell scripts</a>

            <ul>
              <li>
                <a href="#sec-3-1">3.1. Send an email</a>

                <ul>
                  <li><a href="#sec-3-1-1">3.1.1. Name</a></li>

                  <li><a href="#sec-3-1-2">3.1.2. Synopsis</a></li>

                  <li><a href="#sec-3-1-3">3.1.3. Description</a></li>

                  <li><a href="#sec-3-1-4">3.1.4. Options</a></li>

                  <li><a href="#sec-3-1-5">3.1.5. Stdin</a></li>

                  <li><a href="#sec-3-1-6">3.1.6. Input files</a></li>

                  <li><a href="#sec-3-1-7">3.1.7. Environment
                  variables</a></li>

                  <li><a href="#sec-3-1-8">3.1.8. Stdout</a></li>

                  <li><a href="#sec-3-1-9">3.1.9. Stderr</a></li>

                  <li><a href="#sec-3-1-10">3.1.10. Output files</a></li>

                  <li><a href="#sec-3-1-11">3.1.11. Exit status</a></li>

                  <li><a href="#sec-3-1-12">3.1.12. Examples</a></li>

                  <li><a href="#sec-3-1-13">3.1.13. Code</a></li>
                </ul>
              </li>

              <li><a href="#sec-3-2">3.2. Echo text in color</a></li>
            </ul>
          </li>

          <li><a href="#sec-4">4. VC</a></li>

          <li>
            <a href="#sec-5">5. Web security assessments</a>

            <ul>
              <li><a href="#sec-5-1">5.1. HTTP</a></li>

              <li><a href="#sec-5-2">5.2. HTTPS</a></li>
            </ul>
          </li>

          <li>
            <a href="#sec-6">6. Netcat</a>

            <ul>
              <li><a href="#sec-6-1">6.1. Scan only certain ports</a></li>

              <li><a href="#sec-6-2">6.2. DNS</a></li>

              <li><a href="#sec-6-3">6.3. Spoof source IP address</a></li>

              <li><a href="#sec-6-4">6.4. Socat</a></li>

              <li><a href="#sec-6-5">6.5. Packet forger</a></li>

              <li><a href="#sec-6-6">6.6. Lauching attacks via Tor</a></li>
            </ul>
          </li>
        </ul>
      </div>
    </div>

    <div class="org-src-container">
      <pre class="src src-emacs-lisp" id="current-time">
(format-time-string <span style="color: #036A07;">"%Y%m%d.%H%M"</span>)
</pre>
    </div>

    <div id="outline-container-sec-1" class="outline-2">
      <h2 id="sec-1"><span class="section-number-2">1</span> Context</h2>

      <div class="outline-text-2" id="text-1"></div>

      <div id="outline-container-sec-1-1" class="outline-3">
        <h3 id="sec-1-1"><span class="section-number-3">1.1</span>
        Description</h3>

        <div class="outline-text-3" id="text-1-1">
          <p>The shell utilities are core shell functions and scripts which I
          wrote when doing my day-to-day tasks. Over time, this will become a
          <b>powerful toolkit</b>.</p>
        </div>
      </div>

      <div id="outline-container-sec-1-2" class="outline-3">
        <h3 id="sec-1-2"><span class="section-number-3">1.2</span> See
        also</h3>

        <div class="outline-text-3" id="text-1-2">
          <p>For similar collections, see:</p>

          <ul class="org-ul">
            <li><a href=
            "http://icodesnippet.com/">http://icodesnippet.com/</a></li>

            <li><a href=
            "http://exploitsdownload.com/">http://exploitsdownload.com/</a></li>

            <li><a href=
            "http://code.google.com/">http://code.google.com/</a></li>

            <li><a href=
            "https://bbs.archlinux.org/viewtopic.php?id=56646&amp;p=1">Post
            your handy self made command line utilities</a></li>
          </ul>
        </div>
      </div>

      <div id="outline-container-sec-1-3" class="outline-3">
        <h3 id="sec-1-3"><span class="section-number-3">1.3</span>
        Prerequisites</h3>

        <div class="outline-text-3" id="text-1-3">
          <ul class="org-ul">
            <li>Clear</li>

            <li>Diff</li>

            <li>Iconv</li>
          </ul>
        </div>
      </div>
    </div>

    <div id="outline-container-sec-2" class="outline-2">
      <h2 id="sec-2"><span class="section-number-2">2</span> Shell
      functions</h2>

      <div class="outline-text-2" id="text-2">
        <p>Only use alphanumeric characters and the underscore for function
        names.</p>
      </div>

      <div id="outline-container-sec-2-1" class="outline-3">
        <h3 id="sec-2-1"><span class="section-number-3">2.1</span> Exit with an
        error</h3>

        <div class="outline-text-3" id="text-2-1">
          <p>The exit status follows the conventions for programs such as
          <code>grep</code>, <code>cmp</code>, and <code>diff</code>: it is 2
          (or greater) if an error occurred.</p>

          <div class="org-src-container">
            <pre class="src src-sh">
<span style="color: #006699;">die</span> () {
    printf <span style=
"color: #036A07;">"$(basename $0): $@\n"</span> &gt; /dev/stderr
    <span style=
"color: #0000FF;">exit</span> 2                              <span style=
"color: #8D8D84;"># </span><span style=
"color: #8D8D84; font-style: italic;">an </span><span style=
"color: #CC0000; background-color: #FFFF88; font-style: italic;">error</span><span style="color: #8D8D84; font-style: italic;"> occurred</span>
}
</pre>
          </div>
        </div>
      </div>

      <div id="outline-container-sec-2-2" class="outline-3">
        <h3 id="sec-2-2"><span class="section-number-3">2.2</span> Find the
        name of the parent process</h3>

        <div class="outline-text-3" id="text-2-2">
          <p>The following is supposed to work on Linux, but doesn’t on
          Cygwin.</p>

          <div class="org-src-container">
            <pre class="src src-sh">
<span style="color: #006699;">pname</span> () {
    ps -o <span style="color: #BA36A5;">command</span>= -p $<span style=
"color: #BA36A5;">PPID</span> | tail -n 1 | awk <span style=
"color: #036A07;">'{print $1}'</span> | awk -F/ <span style=
"color: #036A07;">'{print $NF}'</span>
}
</pre>
          </div>
        </div>
      </div>
    </div>

    <div id="outline-container-sec-3" class="outline-2">
      <h2 id="sec-3"><span class="section-number-2">3</span> Shell scripts</h2>

      <div class="outline-text-2" id="text-3"></div>

      <div id="outline-container-sec-3-1" class="outline-3">
        <h3 id="sec-3-1"><span class="section-number-3">3.1</span> Send an
        email</h3>

        <div class="outline-text-3" id="text-3-1">
          <p>Send a mail to one or more people.</p>
        </div>

        <div id="outline-container-sec-3-1-1" class="outline-4">
          <h4 id="sec-3-1-1"><span class="section-number-4">3.1.1</span>
          Name</h4>

          <div class="outline-text-4" id="text-3-1-1">
            <div class="org-src-container">
              <pre class="src src-sh">
<span style="color: #8D8D84;"># </span><span style=
"color: #8D8D84; font-style: italic;">mail -- Send simple mail</span>
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-3-1-2" class="outline-4">
          <h4 id="sec-3-1-2"><span class="section-number-4">3.1.2</span>
          Synopsis</h4>

          <div class="outline-text-4" id="text-3-1-2">
            <div class="org-src-container">
              <pre class="src src-sh">
<span style="color: #006699;">Usage</span> ()
{
    cat &lt;&lt; EOF 1&gt;&amp;2
<span style=
"color: #0000ff; background-color: #EEF5FE;">Usage: $CMD [-s SUBJECT] [-a ATTACHMENT]... [-c CC-ADDR] [-b BCC-ADDR] [-f FROM-ADDR] TO-ADDR</span>
<span style=
"color: #0000ff; background-color: #EEF5FE;">Try '$CMD -h' for more information.</span>
<span style="color: #0000ff; background-color: #EEF5FE;">EOF</span>
    <span style="color: #0000FF;">exit</span> 2
}
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-3-1-3" class="outline-4">
          <h4 id="sec-3-1-3"><span class="section-number-4">3.1.3</span>
          Description</h4>

          <div class="outline-text-4" id="text-3-1-3">
            <p>Send an email using <code>mail</code>:</p>

            <div class="org-src-container">
              <pre class="src src-sh">
mail -s <span style=
"color: #036A07;">"Subject"</span> recipient@example.com &lt; /path/to/file
cat /path/to/file | mail -s <span style=
"color: #036A07;">"Subject"</span> recipient@example.com
<span style="color: #006FE0;">echo</span> <span style=
"color: #036A07;">"Message"</span> | mail -s <span style=
"color: #036A07;">"Subject"</span> recipient@example.com
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-3-1-4" class="outline-4">
          <h4 id="sec-3-1-4"><span class="section-number-4">3.1.4</span>
          Options</h4>

          <div class="outline-text-4" id="text-3-1-4">
            <p>The following options shall be supported:</p>

            <div class="org-src-container">
              <pre class="src src-sh">
<span style="color: #006699;">Help</span> ()
{
    cat &lt;&lt; EOF
<span style=
"color: #0000ff; background-color: #EEF5FE;">This is $CMD, version: 20140516.1101.</span>

<span style=
"color: #0000ff; background-color: #EEF5FE;">Usage: $CMD [-s SUBJECT] [-a ATTACHMENT]... [-c CC-ADDR] [-b BCC-ADDR] [-f FROM-ADDR] TO-ADDR</span>
<span style=
"color: #0000ff; background-color: #EEF5FE;">Send simple mail.</span>
<span style=
"color: #0000ff; background-color: #EEF5FE;">Example: $CMD -s 'Disk failure' bill@example.com &lt; /tmp/message</span>

<span style="color: #0000ff; background-color: #EEF5FE;">Options:</span>
<span style=
"color: #0000ff; background-color: #EEF5FE;">  -s  Specify subject on command line</span>
<span style=
"color: #0000ff; background-color: #EEF5FE;">  -a  Attach a file</span>
<span style=
"color: #0000ff; background-color: #EEF5FE;">  -c  Send carbon copies to (comma separated) list of recipients</span>
<span style=
"color: #0000ff; background-color: #EEF5FE;">  -b  Send blind carbon copies to (comma separated) list of recipients</span>
<span style=
"color: #0000ff; background-color: #EEF5FE;">  -f  Set the From address</span>
<span style=
"color: #0000ff; background-color: #EEF5FE;">  -h  Display this help and exit</span>
<span style="color: #0000ff; background-color: #EEF5FE;">EOF</span>
    <span style="color: #0000FF;">exit</span> 0
}
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-3-1-5" class="outline-4">
          <h4 id="sec-3-1-5"><span class="section-number-4">3.1.5</span>
          Stdin</h4>

          <div class="outline-text-4" id="text-3-1-5">
            <p>When <code>mail</code> is invoked, standard input shall be the
            message to be delivered to the specified addresses.</p>
          </div>
        </div>

        <div id="outline-container-sec-3-1-6" class="outline-4">
          <h4 id="sec-3-1-6"><span class="section-number-4">3.1.6</span> Input
          files</h4>

          <div class="outline-text-4" id="text-3-1-6">
            <p>None.</p>
          </div>
        </div>

        <div id="outline-container-sec-3-1-7" class="outline-4">
          <h4 id="sec-3-1-7"><span class="section-number-4">3.1.7</span>
          Environment variables</h4>

          <div class="outline-text-4" id="text-3-1-7">
            <p>The behavior of <code>mail</code> is affected by the following
            environment variable:</p>

            <dl class="org-dl">
              <dt><code>SMTP</code></dt>

              <dd>The SMTP connection is made to the server specified by the
              variable <code>SMTP</code>.</dd>
            </dl>
          </div>
        </div>

        <div id="outline-container-sec-3-1-8" class="outline-4">
          <h4 id="sec-3-1-8"><span class="section-number-4">3.1.8</span>
          Stdout</h4>

          <div class="outline-text-4" id="text-3-1-8">
            <p>The standard output shall be that of the <code>blat</code>
            command.</p>
          </div>
        </div>

        <div id="outline-container-sec-3-1-9" class="outline-4">
          <h4 id="sec-3-1-9"><span class="section-number-4">3.1.9</span>
          Stderr</h4>

          <div class="outline-text-4" id="text-3-1-9">
            <p>The standard error shall be used only for diagnostic
            messages.</p>
          </div>
        </div>

        <div id="outline-container-sec-3-1-10" class="outline-4">
          <h4 id="sec-3-1-10"><span class="section-number-4">3.1.10</span>
          Output files</h4>

          <div class="outline-text-4" id="text-3-1-10">
            <p>None.</p>
          </div>
        </div>

        <div id="outline-container-sec-3-1-11" class="outline-4">
          <h4 id="sec-3-1-11"><span class="section-number-4">3.1.11</span> Exit
          status</h4>

          <div class="outline-text-4" id="text-3-1-11">
            <p>The <code>mail</code> utility returns one of the following
            values upon exit:</p>

            <dl class="org-dl">
              <dt>0</dt>

              <dd>Successful completion: one mail was sent.</dd>

              <dt>2</dt>

              <dd>Invalid options were specified on the command line or shell
              input was missing.</dd>
            </dl>

            <p>Otherwise, the exit status of <code>mail</code> shall be that of
            the <code>blat</code> command.</p>
          </div>
        </div>

        <div id="outline-container-sec-3-1-12" class="outline-4">
          <h4 id="sec-3-1-12"><span class="section-number-4">3.1.12</span>
          Examples</h4>

          <div class="outline-text-4" id="text-3-1-12">
            <p>Here’s a shell script that reports the disk usage:</p>

            <div class="org-src-container">
              <pre class="src src-sh">
( printf <span style=
"color: #036A07;">"Disk usage:\n"</span> ; du -sh ) | mail -s <span style=
"color: #036A07;">"Disk usage report"</span> recipient@example.com
</pre>
            </div>

            <p>Here’s another one to backup a configuration folder, archive it,
            and send it as an attachment:</p>

            <div class="org-src-container">
              <pre class="src src-sh">
tar -zcf ~/backup.tar.gz ~/files_to_backup
printf <span style=
"color: #036A07;">"Archived configuration files\n"</span> | mail -s <span style="color: #036A07;">"Backup data"</span> -a ~/backup.tar.gz recipient@example.com
</pre>
            </div>
          </div>
        </div>

        <div id="outline-container-sec-3-1-13" class="outline-4">
          <h4 id="sec-3-1-13"><span class="section-number-4">3.1.13</span>
          Code</h4>

          <div class="outline-text-4" id="text-3-1-13">
            <div class="org-src-container">
              <pre class="src src-sh">
. shellutils

<span style="color: #8D8D84;"># </span><span style=
"color: #8D8D84; font-style: italic;">command name</span>
<span style="color: #BA36A5;">CMD</span>=$(basename $<span style=
"color: #BA36A5;">0</span>)

<span style="color: #0000FF;">if</span> [ $<span style=
"color: #BA36A5;">#</span> -eq 0 ]; <span style="color: #0000FF;">then</span>
    Usage
<span style="color: #0000FF;">fi</span>

<span style="color: #8D8D84;"># </span><span style=
"color: #8D8D84; font-style: italic;">default values</span>
<span style="color: #BA36A5;">SUBJECT</span>=<span style=
"color: #036A07;">"none"</span>
<span style="color: #BA36A5;">ATTFILES</span>=<span style=
"color: #036A07;">""</span>                             <span style=
"color: #8D8D84;"># </span><span style=
"color: #8D8D84; font-style: italic;">files to be attached</span>
<span style="color: #BA36A5;">CC</span>=<span style="color: #036A07;">""</span>
<span style="color: #BA36A5;">BCC</span>=<span style=
"color: #036A07;">""</span>
<span style="color: #BA36A5;">FROM</span>=<span style=
"color: #036A07;">"$(whoami)@$(echo $(hostname) | tr '[:upper:]' '[:lower:]')"</span>
: ${<span style="color: #BA36A5;">SMTP</span>:=<span style=
"color: #036A07;">"smtp"</span>}                       <span style=
"color: #8D8D84;"># </span><span style=
"color: #8D8D84; font-style: italic;">set var if not already set</span>
<span style="color: #BA36A5;">BODY</span>=<span style=
"color: #036A07;">"--"</span>                               <span style=
"color: #8D8D84;"># </span><span style=
"color: #8D8D84; font-style: italic;">stdin.txt</span>

<span style="color: #0000FF;">while </span><span style=
"color: #006FE0;">getopts</span> <span style=
"color: #036A07;">"s:c:b:f:a:h"</span> opt
<span style="color: #0000FF;">do</span>
    <span style="color: #0000FF;">case</span> <span style=
"color: #036A07;">"$opt"</span><span style="color: #0000FF;"> in</span>
        s) <span style="color: #BA36A5;">SUBJECT</span>=<span style=
"color: #036A07;">"$OPTARG"</span>;;
        a) <span style="color: #BA36A5;">ATTFILES</span>=<span style=
"color: #036A07;">"$ATTFILES $OPTARG"</span>;;
        c) <span style="color: #BA36A5;">CC</span>=<span style=
"color: #036A07;">"$OPTARG"</span>;;
        b) <span style="color: #BA36A5;">BCC</span>=<span style=
"color: #036A07;">"$OPTARG"</span>;;
        f) <span style="color: #BA36A5;">FROM</span>=<span style=
"color: #036A07;">"$OPTARG"</span>;;
        h) Help;;
        *) Usage;;
    <span style="color: #0000FF;">esac</span>
<span style="color: #0000FF;">done</span>
<span style="color: #006FE0;">shift</span> $(($<span style=
"color: #BA36A5;">OPTIND</span> - 1))

<span style="color: #BA36A5;">MAILTO</span>=<span style=
"color: #036A07;">"$1"</span>
<span style="color: #0000FF;">if</span> [ <span style=
"color: #036A07;">"$MAILTO"</span> = <span style=
"color: #036A07;">""</span> ]; <span style="color: #0000FF;">then</span>
    Usage
<span style="color: #0000FF;">fi</span>

<span style="color: #8D8D84;"># </span><span style=
"color: #8D8D84; font-style: italic;">check presence of stdin contents</span>
[ -t 0 ] &amp;&amp; die <span style=
"color: #036A07;">"Message body is missing."</span>

<span style="color: #8D8D84;"># </span><span style=
"color: #8D8D84; font-style: italic;">check for executable files</span>
<span style="color: #0000FF;">for</span> x<span style=
"color: #0000FF;"> in</span> unaccent blat
<span style="color: #0000FF;">do</span>
    command -v $<span style=
"color: #BA36A5;">x</span> &gt; /dev/null || die <span style=
"color: #036A07;">"$x not found."</span>
<span style="color: #0000FF;">done</span>

<span style="color: #BA36A5;">ATT_SWITCH</span>=<span style=
"color: #036A07;">""</span>
<span style="color: #0000FF;">for</span> attach<span style=
"color: #0000FF;"> in</span> $<span style="color: #BA36A5;">ATTFILES</span>
<span style="color: #0000FF;">do</span>
    <span style="color: #0000FF;">if</span> [ ! -r $<span style=
"color: #BA36A5;">attach</span> ]
    <span style="color: #0000FF;">then</span>
        die <span style=
"color: #036A07;">"File $attach does not exist or is not readable."</span>
    <span style="color: #0000FF;">else</span>
        <span style="color: #8D8D84;"># </span><span style=
"color: #8D8D84; font-style: italic;">binary vs text file</span>
        <span style="color: #0000FF;">if</span> [ <span style=
"color: #036A07;">"$(file --brief --mime $attach 2&gt; /dev/null | cut -d/ -f 1)"</span> = <span style="color: #036A07;">"text"</span> ]
        <span style="color: #0000FF;">then</span>
            <span style="color: #BA36A5;">ATT_SWITCH</span>=<span style=
"color: #036A07;">"$ATT_SWITCH -attacht $(cygpath -w $attach)"</span>
        <span style="color: #0000FF;">else</span>
            <span style="color: #BA36A5;">ATT_SWITCH</span>=<span style=
"color: #036A07;">"$ATT_SWITCH -attach $(cygpath -w $attach)"</span>
        <span style="color: #0000FF;">fi</span>
    <span style="color: #0000FF;">fi</span>
<span style="color: #0000FF;">done</span>

<span style="color: #BA36A5;">CC_SWITCH</span>=<span style=
"color: #036A07;">""</span>
[ <span style="color: #036A07;">"$CC"</span> = <span style=
"color: #036A07;">""</span> ] || <span style=
"color: #BA36A5;">CC_SWITCH</span>=<span style=
"color: #036A07;">"-cc ${CC}"</span>

<span style="color: #BA36A5;">BCC_SWITCH</span>=<span style=
"color: #036A07;">""</span>
[ <span style="color: #036A07;">"$BCC"</span> = <span style=
"color: #036A07;">""</span> ] || <span style=
"color: #BA36A5;">BCC_SWITCH</span>=<span style=
"color: #036A07;">"-bcc ${BCC}"</span>

blat -to <span style="color: #036A07;">"$MAILTO"</span> <span style=
"color: #036A07;">\</span>
     $<span style="color: #BA36A5;">CC_SWITCH</span> <span style=
"color: #036A07;">\</span>
     $<span style="color: #BA36A5;">BCC_SWITCH</span> <span style=
"color: #036A07;">\</span>
     -subject <span style=
"color: #036A07;">"$(echo "$SUBJECT" | unaccent)"</span> <span style=
"color: #036A07;">\</span>
     -f <span style="color: #036A07;">"$FROM"</span> <span style=
"color: #036A07;">\</span>
     -server <span style="color: #036A07;">"$SMTP"</span> <span style=
"color: #036A07;">\</span>
     $<span style="color: #BA36A5;">ATT_SWITCH</span>

<span style="color: #8D8D84;"># </span><span style=
"color: #8D8D84; font-style: italic;">mail ends here</span>
</pre>
            </div>
          </div>
        </div>
      </div>

      <div id="outline-container-sec-3-2" class="outline-3">
        <h3 id="sec-3-2"><span class="section-number-3">3.2</span> Echo text in
        color</h3>

        <div class="outline-text-3" id="text-3-2">
          <div class="org-src-container">
            <pre class="src src-sh">
<span style="color: #006699;">cecho</span> () {
    <span style="color: #BA36A5;">black</span>=<span style=
"color: #036A07;">"\e[30m"</span>
    <span style="color: #BA36A5;">red</span>=<span style=
"color: #036A07;">"\e[31m"</span>
    <span style="color: #BA36A5;">green</span>=<span style=
"color: #036A07;">"\e[32m"</span>
    <span style="color: #BA36A5;">yellow</span>=<span style=
"color: #036A07;">"\e[33m"</span>
    <span style="color: #BA36A5;">blue</span>=<span style=
"color: #036A07;">"\e[34m"</span>
    <span style="color: #BA36A5;">magenta</span>=<span style=
"color: #036A07;">"\e[35m"</span>
    <span style="color: #BA36A5;">cyan</span>=<span style=
"color: #036A07;">"\e[36m"</span>
    <span style="color: #BA36A5;">white</span>=<span style=
"color: #036A07;">"\e[37m"</span>
    <span style="color: #BA36A5;">reset</span>=<span style=
"color: #036A07;">"\e[0m"</span>

    <span style="color: #BA36A5;">color</span>=${<span style=
"color: #BA36A5;">green</span>}
    printf <span style="color: #036A07;">"$color$1$reset\n"</span>
}

cecho <span style="color: #036A07;">"$@"</span>
</pre>
          </div>
        </div>
      </div>
    </div>

    <div id="outline-container-sec-4" class="outline-2">
      <h2 id="sec-4"><span class="section-number-2">4</span> VC</h2>

      <div class="outline-text-2" id="text-4">
        <p><a href=
        "http://superuser.com/questions/44787/looping-through-subdirectories-and-running-a-command-in-each">
        http://superuser.com/questions/44787/looping-through-subdirectories-and-running-a-command-in-each</a></p>

        <div class="org-src-container">
          <pre class="src src-sh" id="vc-update">
<span style="color: #0000FF;">for</span> dir<span style=
"color: #0000FF;"> in</span> ~/src/*
<span style="color: #0000FF;">do</span>
    cecho <span style="color: #036A07;">"Updating $dir:"</span>
    <span style="color: #0000FF;">if</span> [ -d $<span style=
"color: #BA36A5;">dir</span>/.git ]; <span style="color: #0000FF;">then</span>
        (<span style="color: #006FE0;">cd</span> $<span style=
"color: #BA36A5;">dir</span> &amp;&amp; git pull)
    <span style="color: #0000FF;">elif</span> [ -d $<span style=
"color: #BA36A5;">dir</span>/.svn ]; <span style="color: #0000FF;">then</span>
        (<span style="color: #006FE0;">cd</span> $<span style=
"color: #BA36A5;">dir</span> &amp;&amp; svn update)
    <span style="color: #0000FF;">fi</span>
    printf <span style="color: #036A07;">"\n"</span>
<span style="color: #0000FF;">done</span>
</pre>
        </div>

        <p>If you need it to be recursive:</p>

        <div class="org-src-container">
          <pre class="src src-sh" id="git-recursive-update">
find -type d -printf <span style=
"color: #036A07;">"%f"</span> -exec  sh -c <span style=
"color: #036A07;">"cd \"{}\" &amp;&amp; git pull"</span>  <span style=
"color: #036A07;">\;</span>
</pre>
        </div>

        <p>See <a href=
        "http://snipplr.com/view/6228/recursively-find-subversion-working-copies-and-update/">
        http://snipplr.com/view/6228/recursively-find-subversion-working-copies-and-update/</a></p>
      </div>
    </div>

    <div id="outline-container-sec-5" class="outline-2">
      <h2 id="sec-5"><span class="section-number-2">5</span> Web security
      assessments</h2>

      <div class="outline-text-2" id="text-5"></div>

      <div id="outline-container-sec-5-1" class="outline-3">
        <h3 id="sec-5-1"><span class="section-number-3">5.1</span> HTTP</h3>

        <div class="outline-text-3" id="text-5-1">
          <p>From Hacking Exposed Web Applications:</p>

          <div class="org-src-container">
            <pre class="src src-sh">
<span style="color: #8D8D84;">#</span><span style=
"color: #8D8D84; font-style: italic;">!/bin/</span><span style=
"color: #0000FF;">sh</span>
<span style="color: #8D8D84;"># </span><span style=
"color: #8D8D84; font-style: italic;">mike's getit.sh script</span>
<span style="color: #0000FF;">if</span> [ -z $<span style=
"color: #BA36A5;">1</span> ]; <span style="color: #0000FF;">then</span>
<span style="color: #006FE0;">echo</span> -e <span style=
"color: #036A07;">"\n\tUsage: $0 &lt;host&gt; &lt;URL&gt;"</span>
<span style="color: #0000FF;">exit</span>
<span style="color: #0000FF;">fi</span>
<span style="color: #006FE0;">echo</span> -e <span style=
"color: #036A07;">"GET $2 HTTP/1.0\n\n"</span> | <span style=
"color: #036A07;">\</span>
nc -vv $<span style="color: #BA36A5;">1</span> 80
</pre>
          </div>

          <div class="org-src-container">
            <pre class="src src-sh">
getit.sh www.missioncriticalit.com /index.html
</pre>
          </div>

          <div class="org-src-container">
            <pre class="src src-sh">
getit.sh www.victim.com /index.html | grep -i <span style=
"color: #036A07;">"&lt;form"</span>
</pre>
          </div>

          <div class="org-src-container">
            <pre class="src src-sh">
getit.sh www.victim.com /index.html | grep -i <span style=
"color: #036A07;">"input type"</span>
</pre>
          </div>
        </div>
      </div>

      <div id="outline-container-sec-5-2" class="outline-3">
        <h3 id="sec-5-2"><span class="section-number-3">5.2</span> HTTPS</h3>

        <div class="outline-text-3" id="text-5-2">
          <div class="org-src-container">
            <pre class="src src-sh">
<span style="color: #8D8D84;">#</span><span style=
"color: #8D8D84; font-style: italic;">!/bin/</span><span style=
"color: #0000FF;">sh</span>
<span style="color: #8D8D84;"># </span><span style=
"color: #8D8D84; font-style: italic;">mike's sgetit.sh script</span>
<span style="color: #0000FF;">if</span> [ -z $<span style=
"color: #BA36A5;">1</span> ]; <span style="color: #0000FF;">then</span>
<span style="color: #006FE0;">echo</span> -e <span style=
"color: #036A07;">"\n\tUsage: $0 &lt;SSL host&gt; &lt;URL&gt;"</span>
<span style="color: #0000FF;">exit</span>
<span style="color: #0000FF;">fi</span>
<span style="color: #006FE0;">echo</span> -e <span style=
"color: #036A07;">"GET $2 HTTP/1.0\n\n"</span> | <span style=
"color: #036A07;">\</span>
openssl s_client -quiet -connect $<span style=
"color: #BA36A5;">1</span>:443 2&gt;/dev/null
</pre>
          </div>

          <div class="org-src-container">
            <pre class="src src-sh">
sgetit.sh www.victim.com /secure/admin.html
</pre>
          </div>
        </div>
      </div>
    </div>

    <div id="outline-container-sec-6" class="outline-2">
      <h2 id="sec-6"><span class="section-number-2">6</span> Netcat</h2>

      <div class="outline-text-2" id="text-6">
        <p>Here is a script which will port scan and banner grab automatically
        with netcat. It will check for the SSH and MySQL version by connecting
        and saving the results and it will see if the HTTP server is vulnerable
        to the <code>TRACE</code> method, look in the dumpfile
        <code>/tmp/bannergrab</code> and look for
        <code>&lt;script&gt;alert(123)&lt;/script&gt;</code> if you can find
        that back you got yourself a vulnerable server.</p>

        <div class="org-src-container">
          <pre class="src src-sh">
<span style="color: #8D8D84;">#</span><span style=
"color: #8D8D84; font-style: italic;">!/bin/</span><span style=
"color: #0000FF;">sh</span>

<span style="color: #BA36A5;">range</span>=<span style=
"color: #036A07;">"10.10.10."</span>;

<span style="color: #8D8D84;"># </span><span style=
"color: #8D8D84; font-style: italic;">You can change this to a port range $(seq 20 25) is port 20-25</span>
<span style="color: #BA36A5;">ports</span>=<span style=
"color: #036A07;">"20 21 22 23 25 53 80 110 111 443 3306 6000"</span>;

<span style="color: #BA36A5;">http_header</span>=<span style=
"color: #036A07;">"HEAD / HTTP/0.1\n\n"</span>;

<span style="color: #0000FF;">for</span> host<span style=
"color: #0000FF;"> in</span> $(seq 2 254); <span style=
"color: #0000FF;">do</span>
    <span style="color: #0000FF;">for</span> port<span style=
"color: #0000FF;"> in</span> $<span style=
"color: #BA36A5;">ports</span>; <span style="color: #0000FF;">do</span>
        <span style="color: #006FE0;">echo</span> <span style=
"color: #036A07;">"[+] Testing "</span>$<span style=
"color: #BA36A5;">range</span>$<span style=
"color: #BA36A5;">host</span><span style=
"color: #036A07;">":"</span>$<span style="color: #BA36A5;">port</span>;
        <span style="color: #BA36A5;">result</span>=$(nc -zv -w 1 $<span style=
"color: #BA36A5;">range</span>$<span style=
"color: #BA36A5;">host</span> $<span style=
"color: #BA36A5;">port</span> 2&gt;&amp;1 | grep succeeded);
        <span style="color: #0000FF;">if</span> [ -n <span style=
"color: #036A07;">"$result"</span> ]; <span style="color: #0000FF;">then</span>
            <span style="color: #006FE0;">echo</span> <span style=
"color: #036A07;">"\n"</span>$<span style=
"color: #BA36A5;">range</span>$<span style=
"color: #BA36A5;">host</span><span style=
"color: #036A07;">":"</span>$<span style=
"color: #BA36A5;">port</span><span style=
"color: #036A07;">"\n"</span> &gt;&gt; <span style=
"color: #036A07;">"/tmp/bannergrab"</span>
            <span style="color: #0000FF;">if</span> [ <span style=
"color: #036A07;">"$port"</span> -eq <span style=
"color: #036A07;">"22"</span> ]; <span style="color: #0000FF;">then</span>
                <span style="color: #006FE0;">echo</span> <span style=
"color: #036A07;">"Found open port "</span>$<span style=
"color: #BA36A5;">range</span>$<span style=
"color: #BA36A5;">host</span><span style=
"color: #036A07;">":"</span>$<span style=
"color: #BA36A5;">port</span><span style=
"color: #036A07;">" Here might be some SSH server, it echoes the SSH version to you on connecting when lucky."</span>;
                nc -v -w 1 $<span style=
"color: #BA36A5;">range</span>$<span style=
"color: #BA36A5;">host</span> $<span style=
"color: #BA36A5;">port</span> &gt;&gt; <span style=
"color: #036A07;">"/tmp/bannergrab"</span>;
            <span style="color: #0000FF;">fi</span>;
            <span style="color: #0000FF;">if</span> [ <span style=
"color: #036A07;">"$port"</span> -eq <span style=
"color: #036A07;">"80"</span> ]; <span style="color: #0000FF;">then</span>
                <span style="color: #006FE0;">echo</span> <span style=
"color: #036A07;">"Found open port "</span>$<span style=
"color: #BA36A5;">range</span>$<span style=
"color: #BA36A5;">host</span><span style=
"color: #036A07;">":"</span>$<span style=
"color: #BA36A5;">port</span><span style=
"color: #036A07;">" Trying to fingerprint with HEAD and see if the server is vulnerable to TRACE XSSing"</span>;
                <span style="color: #006FE0;">echo</span> $<span style=
"color: #BA36A5;">http_header</span> | nc -v -w 1 $<span style=
"color: #BA36A5;">range</span>$<span style=
"color: #BA36A5;">host</span> $<span style=
"color: #BA36A5;">port</span> &gt;&gt; <span style=
"color: #036A07;">"/tmp/bannergrab"</span>
                <span style="color: #006FE0;">echo</span> <span style=
"color: #036A07;">"TRACE / HTTP/1.1\nHost: $range$host\nuser-agent: &lt;script&gt;alert(123)&lt;/script&gt;\n\n"</span> | nc -v -w 2 $<span style="color: #BA36A5;">range</span>$<span style="color: #BA36A5;">host</span> $<span style="color: #BA36A5;">port</span> &gt;&gt; <span style="color: #036A07;">"/tmp/bannergrab"</span>
            <span style="color: #0000FF;">fi</span>;
            <span style="color: #0000FF;">if</span> [ <span style=
"color: #036A07;">"$port"</span> -eq <span style=
"color: #036A07;">"3306"</span> ]; <span style="color: #0000FF;">then</span>
                <span style="color: #006FE0;">echo</span> <span style=
"color: #036A07;">"Found open port "</span>$<span style=
"color: #BA36A5;">range</span>$<span style=
"color: #BA36A5;">host</span><span style=
"color: #036A07;">":"</span>$<span style=
"color: #BA36A5;">port</span><span style=
"color: #036A07;">" Possible MySQL installation found, saving the banner for later inspection, the MySQL version can be found in this."</span>;
                nc -v -w 1 $<span style=
"color: #BA36A5;">range</span>$<span style=
"color: #BA36A5;">host</span> $<span style=
"color: #BA36A5;">port</span> &gt;&gt; <span style=
"color: #036A07;">"/tmp/bannergrab"</span>;
            <span style="color: #0000FF;">fi</span>;
        <span style="color: #0000FF;">fi</span>;
    <span style="color: #0000FF;">done</span>
<span style="color: #0000FF;">done</span>
</pre>
        </div>

        <p>A lot more on <a href=
        "http://h.ackack.net/cheatsheets/netcat/">http://h.ackack.net/cheatsheets/netcat/</a>:
        how to workaround <code>-e cmd.exe</code> option which disappeared,
        etc.</p>
      </div>

      <div id="outline-container-sec-6-1" class="outline-3">
        <h3 id="sec-6-1"><span class="section-number-3">6.1</span> Scan only
        certain ports</h3>

        <div class="outline-text-3" id="text-6-1">
          <div class="org-src-container">
            <pre class="src src-sh">
nc -z -w 1 -v -v 10.10.10.11 20-30,53,80,100-112,443,6000-6050
</pre>
          </div>
        </div>
      </div>

      <div id="outline-container-sec-6-2" class="outline-3">
        <h3 id="sec-6-2"><span class="section-number-3">6.2</span> DNS</h3>

        <div class="outline-text-3" id="text-6-2">
          <div class="org-src-container">
            <pre class="src src-sh">
nc -p 53 -w 2 -v -v firewall.yournetwork.com 53
nc -u -p 53 -w 2 -v -v firewall.yournetwork.com 53
</pre>
          </div>
        </div>
      </div>

      <div id="outline-container-sec-6-3" class="outline-3">
        <h3 id="sec-6-3"><span class="section-number-3">6.3</span> Spoof source
        IP address</h3>

        <div class="outline-text-3" id="text-6-3">
          <p><code>-s</code> option to Netcat: does not work under Cygwin…</p>
        </div>
      </div>

      <div id="outline-container-sec-6-4" class="outline-3">
        <h3 id="sec-6-4"><span class="section-number-3">6.4</span> Socat</h3>

        <div class="outline-text-3" id="text-6-4">
          <p>Learning socat in terms of netcat: <a href=
          "http://jdimpson.livejournal.com/6534.html">http://jdimpson.livejournal.com/6534.html</a></p>

          <ul class="org-ul">
            <li>
              <b>Remote access server</b>

              <div class="org-src-container">
                <pre class="src src-sh">
socat TCP-LISTEN:2323,reuseaddr EXEC:/bin/bash
</pre>
              </div>
            </li>

            <li>
              <b>Data forwarder</b> (aka simple proxy)

              <div class="org-src-container">
                <pre class="src src-sh">
socat TCP-L:2323 TCP:localhost:22
</pre>
              </div>

              <p>And of course, you can replace either address with any other
              socat address we’ve already talked about (UDP, UDP-L), or ones
              we’ll talk about in another post (e.g. SSL).</p>
            </li>
          </ul>
        </div>
      </div>

      <div id="outline-container-sec-6-5" class="outline-3">
        <h3 id="sec-6-5"><span class="section-number-3">6.5</span> Packet
        forger</h3>

        <div class="outline-text-3" id="text-6-5">
          <p>SendIP</p>
        </div>
      </div>

      <div id="outline-container-sec-6-6" class="outline-3">
        <h3 id="sec-6-6"><span class="section-number-3">6.6</span> Lauching
        attacks via Tor</h3>

        <div class="outline-text-3" id="text-6-6">
          <p><a href=
          "http://www.oreillynet.com/onlamp/blog/2005/07/launching_attacks_via_tor.html">
          http://www.oreillynet.com/onlamp/blog/2005/07/launching_attacks_via_tor.html</a></p>
        </div>
      </div>
    </div>
  </div>

  <div id="postamble" class="status">
    <div id="footer">
      <div id="copyright">
        Copyright © Fabrice Niessen
      </div>
    </div>
  </div>
</body>
</html>
