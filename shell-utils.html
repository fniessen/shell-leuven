<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Shell utilities</title>
<!-- 2017-08-12 Sat 11:26 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Fabrice Niessen" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Shell utilities</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Context</a>
<ul>
<li><a href="#sec-1-1">1.1. Description</a></li>
<li><a href="#sec-1-2">1.2. See also</a></li>
<li><a href="#sec-1-3">1.3. Coding style</a></li>
<li><a href="#sec-1-4">1.4. Prerequisites</a></li>
</ul>
</li>
<li><a href="#sec-2">2. Shell aliases</a>
<ul>
<li><a href="#sec-2-1">2.1. Find all of the distinct file extensions in a folder hierarchy</a></li>
</ul>
</li>
<li><a href="#sec-3">3. Shell functions</a>
<ul>
<li><a href="#sec-3-1">3.1. Exit with an error</a></li>
<li><a href="#sec-3-2">3.2. Check for executable files</a></li>
<li><a href="#sec-3-3">3.3. Check for Cygwin executable files</a></li>
<li><a href="#sec-3-4">3.4. Find the name of the parent process</a></li>
</ul>
</li>
<li><a href="#sec-4">4. Shell scripts</a>
<ul>
<li><a href="#sec-4-1">4.1. Send an email</a>
<ul>
<li><a href="#sec-4-1-1">4.1.1. Name</a></li>
<li><a href="#sec-4-1-2">4.1.2. Synopsis</a></li>
<li><a href="#sec-4-1-3">4.1.3. Description</a></li>
<li><a href="#sec-4-1-4">4.1.4. Options</a></li>
<li><a href="#sec-4-1-5">4.1.5. Stdin</a></li>
<li><a href="#sec-4-1-6">4.1.6. Input files</a></li>
<li><a href="#sec-4-1-7">4.1.7. Environment variables</a></li>
<li><a href="#sec-4-1-8">4.1.8. Stdout</a></li>
<li><a href="#sec-4-1-9">4.1.9. Stderr</a></li>
<li><a href="#sec-4-1-10">4.1.10. Output files</a></li>
<li><a href="#sec-4-1-11">4.1.11. Exit status</a></li>
<li><a href="#sec-4-1-12">4.1.12. Examples</a></li>
<li><a href="#sec-4-1-13">4.1.13. Code</a></li>
</ul>
</li>
<li><a href="#sec-4-2">4.2. Echo text in color</a></li>
<li><a href="#sec-4-3">4.3. Find duplicates</a>
<ul>
<li><a href="#sec-4-3-1">4.3.1. findup &#x2013; find DUPlicate files</a></li>
<li><a href="#sec-4-3-2">4.3.2. findsn &#x2013; find Same Name (problems with clashing names)</a></li>
</ul>
</li>
<li><a href="#sec-4-4">4.4. Utils</a></li>
</ul>
</li>
<li><a href="#sec-5">5. VC</a>
<ul>
<li><a href="#sec-5-1">5.1. Ignore files from the command line</a></li>
</ul>
</li>
<li><a href="#sec-6">6. Web security assessments</a>
<ul>
<li><a href="#sec-6-1">6.1. HTTP</a></li>
<li><a href="#sec-6-2">6.2. HTTPS</a></li>
</ul>
</li>
<li><a href="#sec-7">7. Netcat</a>
<ul>
<li><a href="#sec-7-1">7.1. Scan only certain ports</a></li>
<li><a href="#sec-7-2">7.2. DNS</a></li>
<li><a href="#sec-7-3">7.3. Spoof source IP address</a></li>
<li><a href="#sec-7-4">7.4. Socat</a></li>
<li><a href="#sec-7-5">7.5. Packet forger</a></li>
<li><a href="#sec-7-6">7.6. Lauching attacks via Tor</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="org-src-container">

<pre class="src src-emacs-lisp" id="current-time">(format-time-string "%Y%m%d.%H%M")
</pre>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Context</h2>
<div class="outline-text-2" id="text-1">
</div><div id="outline-container-sec-1-1" class="outline-3">
<h3 id="sec-1-1"><span class="section-number-3">1.1</span> Description</h3>
<div class="outline-text-3" id="text-1-1">
<p>
The shell utilities are core shell functions and scripts which I wrote when
doing my day-to-day tasks.  Over time, this will become a <b>powerful toolkit</b>.
</p>

<div class="note">
<p>
Library of Babel needs the <code>#+name</code> field to "ingest" a code block.
</p>

</div>
</div>
</div>

<div id="outline-container-sec-1-2" class="outline-3">
<h3 id="sec-1-2"><span class="section-number-3">1.2</span> See also</h3>
<div class="outline-text-3" id="text-1-2">
<p>
For similar collections, see:
</p>

<ul class="org-ul">
<li><a href="http://icodesnippet.com/">http://icodesnippet.com/</a>
</li>
<li><a href="http://exploitsdownload.com/">http://exploitsdownload.com/</a>
</li>
<li><a href="http://code.google.com/">http://code.google.com/</a>
</li>
<li><a href="https://bbs.archlinux.org/viewtopic.php?id=56646&p=1">Post your handy self made command line utilities</a>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-3" class="outline-3">
<h3 id="sec-1-3"><span class="section-number-3">1.3</span> Coding style</h3>
<div class="outline-text-3" id="text-1-3">
<ul class="org-ul">
<li><a href="http://wiki.bash-hackers.org/scripting/style">http://wiki.bash-hackers.org/scripting/style</a>
</li>

<li><a href="https://google-styleguide.googlecode.com/svn/trunk/shell.xml">https://google-styleguide.googlecode.com/svn/trunk/shell.xml</a>

<p>
<code>variable_name</code> (preferred, <code>variableName</code> accepted) <br  />
  <code>function_name</code> <br  />
  <code>CONSTANT_NAME</code>
</p>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1-4" class="outline-3">
<h3 id="sec-1-4"><span class="section-number-3">1.4</span> Prerequisites</h3>
<div class="outline-text-3" id="text-1-4">
<ul class="org-ul">
<li>Clear
</li>
<li>Diff
</li>
<li>Iconv
</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Shell aliases</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Find all of the distinct file extensions in a folder hierarchy</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Recursive version:
</p>

<div class="org-src-container">

<pre class="src src-shell">alias file_ext=$'find . -type f -name "*.*" | awk -F. \'!a[$NF]++{print $NF}\''
</pre>
</div>

<p>
Recursive version:
</p>

<div class="org-src-container">

<pre class="src src-shell">find . -type f | sed -e 's/.*\.//' | sed -e 's/.*\///' | sort -u
</pre>
</div>

<p>
If you want totals (how may times the extension was seen):
</p>

<div class="org-src-container">

<pre class="src src-shell">find . -type f | sed -e 's/.*\.//' | sed -e 's/.*\///' | sort | uniq -c | sort -rn
</pre>
</div>

<p>
Non-recursive (single folder):
</p>

<div class="org-src-container">

<pre class="src src-shell">for f in *.*; do printf "%s\n" "${f##*.}"; done | sort -u
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Shell functions</h2>
<div class="outline-text-2" id="text-3">

<p>
Only use alphanumeric characters and the underscore for function names.
</p>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Exit with an error</h3>
<div class="outline-text-3" id="text-3-1">
<p>
The exit status follows the conventions for programs such as <code>grep</code>, <code>cmp</code>, and
<code>diff</code>: it is 2 (or greater) if an error occurred.
</p>

<div class="org-src-container">

<pre class="src src-shell">die () {
    printf "$(basename $0): $@\n" &gt; /dev/stderr
    exit 2                              # An error occurred.
}
</pre>
</div>

<p>
<code>Die</code> <b>must be a function</b> so that the calling script does exit with an error.
</p>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Check for executable files</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">

<pre class="src src-shell">files_executables_p () {
    for x in $@
    do
	command -v $x &gt; /dev/null || die "$x not found."
    done
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> Check for Cygwin executable files</h3>
<div class="outline-text-3" id="text-3-3">
<p>
We sometimes have to check that the <code>PATH</code> is set right, so that Cygwin
executables (for example, <code>whoami</code> and <code>hostname</code>) are found before their Windows
counterpart &#x2013; to avoid problems of spurious <code>\r</code> added to the output.
</p>

<div class="org-src-container">

<pre class="src src-shell">files_cygwin_executables_p () {
    for x in $@
    do
	[ "$(command -v $x)" = "/usr/bin/$x" ] \
	    || die "$x is not a Cygwin executable."
    done
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3-4" class="outline-3">
<h3 id="sec-3-4"><span class="section-number-3">3.4</span> Find the name of the parent process</h3>
<div class="outline-text-3" id="text-3-4">
<p>
The following is supposed to work on Linux, but doesn't on Cygwin.
</p>

<div class="org-src-container">

<pre class="src src-shell">pname () {
    ps -o command= -p $PPID | tail -n 1 | awk '{print $1}' | awk -F/ '{print $NF}'
}
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Shell scripts</h2>
<div class="outline-text-2" id="text-4">
</div>

<div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Send an email</h3>
<div class="outline-text-3" id="text-4-1">

<p>
Send a mail to one or more people.
</p>
</div>

<div id="outline-container-sec-4-1-1" class="outline-4">
<h4 id="sec-4-1-1"><span class="section-number-4">4.1.1</span> Name</h4>
<div class="outline-text-4" id="text-4-1-1">
<div class="org-src-container">

<pre class="src src-shell"># mail -- Send simple mail
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-1-2" class="outline-4">
<h4 id="sec-4-1-2"><span class="section-number-4">4.1.2</span> Synopsis</h4>
<div class="outline-text-4" id="text-4-1-2">
<div class="org-src-container">

<pre class="src src-shell">Usage ()
{
    cat &lt;&lt; EOF 1&gt;&amp;2
Usage: $CMD [-s SUBJECT] [-a ATTACHMENT]... [-c CC-ADDR] [-b BCC-ADDR] [-f FROM-ADDR] TO-ADDR
Try '$CMD -h' for more information.
EOF
    exit 2
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-1-3" class="outline-4">
<h4 id="sec-4-1-3"><span class="section-number-4">4.1.3</span> Description</h4>
<div class="outline-text-4" id="text-4-1-3">
<p>
Send an email using <code>mail</code>:
</p>

<div class="org-src-container">

<pre class="src src-shell">mail -s "Subject" recipient@example.com &lt; /path/to/file
cat /path/to/file | mail -s "Subject" recipient@example.com
echo "Message" | mail -s "Subject" recipient@example.com
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-1-4" class="outline-4">
<h4 id="sec-4-1-4"><span class="section-number-4">4.1.4</span> Options</h4>
<div class="outline-text-4" id="text-4-1-4">
<p>
The following options shall be supported:
</p>

<div class="org-src-container">

<pre class="src src-shell">Help ()
{
    cat &lt;&lt; EOF
This is $CMD, version: 20170812.1126.

Usage: $CMD [-s SUBJECT] [-a ATTACHMENT]... [-c CC-ADDR] [-b BCC-ADDR] [-f FROM-ADDR] TO-ADDR
Send simple mail.
Examples:
    $CMD -s 'Disk failure' bill@example.com &lt; /tmp/message
    print "This is the body." | $CMD -s 'Other subject' bill@example.com

Options:
  -s  Specify subject on command line
  -a  Attach a file
  -c  Send carbon copies to (comma separated) list of recipients
  -b  Send blind carbon copies to (comma separated) list of recipients
  -f  Set the From address
  -h  Display this help and exit
EOF
    exit 0
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-1-5" class="outline-4">
<h4 id="sec-4-1-5"><span class="section-number-4">4.1.5</span> Stdin</h4>
<div class="outline-text-4" id="text-4-1-5">
<p>
When <code>mail</code> is invoked, standard input shall be the message to be delivered to
the specified addresses.
</p>
</div>
</div>

<div id="outline-container-sec-4-1-6" class="outline-4">
<h4 id="sec-4-1-6"><span class="section-number-4">4.1.6</span> Input files</h4>
<div class="outline-text-4" id="text-4-1-6">
<p>
None.
</p>
</div>
</div>

<div id="outline-container-sec-4-1-7" class="outline-4">
<h4 id="sec-4-1-7"><span class="section-number-4">4.1.7</span> Environment variables</h4>
<div class="outline-text-4" id="text-4-1-7">
<p>
The behavior of <code>mail</code> is affected by the following environment variable:
</p>

<dl class="org-dl">
<dt> <code>SMTP</code> </dt><dd>     The SMTP connection is made to the server specified by the variable <code>SMTP</code>.
</dd>
</dl>
</div>
</div>

<div id="outline-container-sec-4-1-8" class="outline-4">
<h4 id="sec-4-1-8"><span class="section-number-4">4.1.8</span> Stdout</h4>
<div class="outline-text-4" id="text-4-1-8">
<p>
The standard output shall be that of the <code>blat</code> command.
</p>
</div>
</div>

<div id="outline-container-sec-4-1-9" class="outline-4">
<h4 id="sec-4-1-9"><span class="section-number-4">4.1.9</span> Stderr</h4>
<div class="outline-text-4" id="text-4-1-9">
<p>
The standard error shall be used only for diagnostic messages.
</p>
</div>
</div>

<div id="outline-container-sec-4-1-10" class="outline-4">
<h4 id="sec-4-1-10"><span class="section-number-4">4.1.10</span> Output files</h4>
<div class="outline-text-4" id="text-4-1-10">
<p>
None.
</p>
</div>
</div>

<div id="outline-container-sec-4-1-11" class="outline-4">
<h4 id="sec-4-1-11"><span class="section-number-4">4.1.11</span> Exit status</h4>
<div class="outline-text-4" id="text-4-1-11">
<p>
The <code>mail</code> utility returns one of the following values upon exit:
</p>

<dl class="org-dl">
<dt> 0 </dt><dd>     Successful completion: one mail was sent.
</dd>

<dt> 2 </dt><dd>     Invalid options were specified on the command line or shell input was
missing.
</dd>
</dl>

<p>
Otherwise, the exit status of <code>mail</code> shall be that of the <code>blat</code> command.
</p>
</div>
</div>

<div id="outline-container-sec-4-1-12" class="outline-4">
<h4 id="sec-4-1-12"><span class="section-number-4">4.1.12</span> Examples</h4>
<div class="outline-text-4" id="text-4-1-12">
<p>
Here's a shell script that reports the disk usage:
</p>

<div class="org-src-container">

<pre class="src src-shell">( printf "Disk usage:\n" ; du -sh ) | mail -s "Disk usage report" recipient@example.com
</pre>
</div>

<p>
Here's another one to backup a configuration folder, archive it, and send it as
an attachment:
</p>

<div class="org-src-container">

<pre class="src src-shell">tar -zcf ~/backup.tar.gz ~/files_to_backup
printf "Archived configuration files\n" | mail -s "Backup data" -a ~/backup.tar.gz recipient@example.com
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-1-13" class="outline-4">
<h4 id="sec-4-1-13"><span class="section-number-4">4.1.13</span> Code</h4>
<div class="outline-text-4" id="text-4-1-13">
<div class="org-src-container">

<pre class="src src-shell"># command name
CMD=$(basename $0)

. shellutils || exit 2

if [ $# -eq 0 ]; then
    Usage
fi

# check for Cygwin executable files (and not their Windows counterpart)
files_cygwin_executables_p "whoami" "hostname"

# default values
SUBJECT="none"
ATTFILES=""                             # files to be attached
CC=""
BCC=""
FROM="&lt;$(whoami)@$(echo $(hostname).com | tr '[:upper:]' '[:lower:]')&gt;"
: ${SMTP:="smtp"}                       # set var if not already set
BODY="--"                               # stdin.txt

while getopts "s:c:b:f:a:h" opt
do
    case "$opt" in
	s) SUBJECT="$OPTARG";;
	a) ATTFILES="$ATTFILES $OPTARG";;
	c) CC="$OPTARG";;
	b) BCC="$OPTARG";;
	f) FROM="$OPTARG";;
	h) Help;;
	*) Usage;;
    esac
done
shift $(($OPTIND - 1))

MAILTO="$1"
if [ "$MAILTO" = "" ]; then
    Usage
fi

# check presence of stdin contents
[ -t 0 ] &amp;&amp; die "Message body is missing."

# check for executable files
files_executables_p "blat"

ATT_SWITCH=""
for attach in $ATTFILES
do
    if [ ! -r $attach ]
    then
	die "File $attach does not exist or is not readable."
    else
	# binary vs text file
	if [ "$(file --brief --mime $attach 2&gt; /dev/null | cut -d/ -f 1)" = "text" ]
	then
	    ATT_SWITCH="$ATT_SWITCH -attacht $(cygpath -w $attach)"
	else
	    ATT_SWITCH="$ATT_SWITCH -attach $(cygpath -w $attach)"
	fi
    fi
done

CC_SWITCH=""
[ "$CC" = "" ] || CC_SWITCH="-cc ${CC}"

BCC_SWITCH=""
[ "$BCC" = "" ] || BCC_SWITCH="-bcc ${BCC}"

blat -to "$MAILTO" \
     $CC_SWITCH \
     $BCC_SWITCH \
     -subject "$SUBJECT" \
     -f "$FROM" \
     -server "$SMTP" \
     $ATT_SWITCH

# mail ends here
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Echo text in color</h3>
<div class="outline-text-3" id="text-4-2">
<div class="org-src-container">

<pre class="src src-shell">cecho () {
    black="\e[30m"
    red="\e[31m"
    green="\e[32m"
    yellow="\e[33m"
    blue="\e[34m"
    magenta="\e[35m"
    cyan="\e[36m"
    white="\e[37m"

    BLACK="\e[1;30m"
    RED="\e[1;31m"
    GREEN="\e[1;32m"
    YELLOW="\e[1;33m"
    BLUE="\e[1;34m"
    MAGENTA="\e[1;35m"
    CYAN="\e[1;36m"
    WHITE="\e[1;37m"

    reset="\e[0m"

    color=${YELLOW}
    printf "$color$1$reset\n"
}

cecho "$@"
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3"><span class="section-number-3">4.3</span> Find duplicates</h3>
<div class="outline-text-3" id="text-4-3">
</div><div id="outline-container-sec-4-3-1" class="outline-4">
<h4 id="sec-4-3-1"><span class="section-number-4">4.3.1</span> findup &#x2013; find DUPlicate files</h4>
<div class="outline-text-4" id="text-4-3-1">
<p>
See fdupes from Cygwin?
</p>

<p>
fdupes -S /etc
</p>

<p>
Sample outputs:
</p>

<pre class="example">
1533 bytes each:
/etc/vimrc
/etc/virc
</pre>
</div>
</div>

<div id="outline-container-sec-4-3-2" class="outline-4">
<h4 id="sec-4-3-2"><span class="section-number-4">4.3.2</span> findsn &#x2013; find Same Name (problems with clashing names)</h4>
<div class="outline-text-4" id="text-4-3-2">
<p>
find (files) with duplicate or conflicting names.
Usage: findsn [-A -c -C] [[-r] [-f] paths(s) &#x2026;]
</p>

<div class="org-src-container">

<pre class="src src-shell">find . -type f | sort | uniq -c | grep -v "^[ \t]*1 "
</pre>
</div>

<div class="org-src-container">

<pre class="src src-shell">#!/usr/bin/env bash

find -type f &gt; names.lst

&gt; names.out

TAB=`echo -ne "\t"`
while read name
do
    bn="$( basename "$name" )"
    name2="$( grep "$bn" names.lst | grep -v "$name" )"
    if [ "$name2" != "" ]
    then
			if !(grep -q "^${name}${TAB}" names.out); then
				size=`stat --format=%s "$name"`
				size2=`stat --format=%s "$name2"`
				echo -e "$name${TAB}$size" &gt;&gt; names.out
				echo -e "$name2${TAB}$size" &gt;&gt; names.out
			fi
    fi
done &lt; names.lst

cat names.out
rm -f names.lst
</pre>
</div>

<div class="org-src-container">

<pre class="src src-shell"># Find Duplicate File Names - By Dev (dk_mahadeva@yahoo.com)
# If no command-line parameter (path to begin from) is specified, then the
# default is to begin from the current (.) directory.
cd path=$1
: ${path:=.}
printf "Building file list...\n" &gt; /dev/stderr
fullList=$(find `pwd` $path | grep -v '^\.' | awk -F '/' '{print $NF,$0}' | sort +0 -1)
fileNames=$(find `pwd` $path | grep -v '^\.' | awk -F '/' '{print $NF}' | sort | uniq -d)
for EACH in $fileNames; do
    echo "$fullList" | grep -wE "^$EACH "
    echo ""
done
exit 0
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="section-number-3">4.4</span> Utils</h3>
<div class="outline-text-3" id="text-4-4">
<div class="org-src-container">

<pre class="src src-shell"># Strip lines with dashes.
sed "s/NULL//g"
</pre>
</div>

<div class="org-src-container">

<pre class="src src-shell"># Delete the second line.
sed -e '2d'
</pre>
</div>

<div class="org-src-container">

<pre class="src src-shell"># Replace NULL value by empty string.
sed "s/NULL//g"
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> VC</h2>
<div class="outline-text-2" id="text-5">

<p>
<a href="http://superuser.com/questions/44787/looping-through-subdirectories-and-running-a-command-in-each">http://superuser.com/questions/44787/looping-through-subdirectories-and-running-a-command-in-each</a>
</p>

<div class="org-src-container">

<pre class="src src-shell" id="vc-update">for dir in ~/src/*
do
    cecho "Updating $dir:"
    if [ -d $dir/.git ]; then
	(cd $dir &amp;&amp; git pull)
    elif [ -d $dir/.svn ]; then
	(cd $dir &amp;&amp; svn update)
    fi
    printf "\n"
done
</pre>
</div>

<p>
If you need it to be recursive:
</p>

<div class="org-src-container">

<pre class="src src-shell" id="git-recursive-update">find -type d -printf "%f" -exec  sh -c "cd \"{}\" &amp;&amp; git pull"  \;
</pre>
</div>

<p>
See <a href="http://snipplr.com/view/6228/recursively-find-subversion-working-copies-and-update/">http://snipplr.com/view/6228/recursively-find-subversion-working-copies-and-update/</a>
</p>
</div>

<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Ignore files from the command line</h3>
<div class="outline-text-3" id="text-5-1">
<p>
Add a file (or a file glob pattern) to ignore without deleting the previous
value of the <code>svn:ignore</code> property&#x2026; from the command line.
</p>

<div class="org-src-container">

<pre class="src src-shell"># Usage: svnignore admin/notes/\*.tex

target="$1"
targetdirectory=$(dirname $target)
targetfilepattern=$(basename $target)

svnignores=$(svn propget svn:ignore "$targetdirectory")
svnignores="$svnignores"$'\n'"$targetfilepattern"
printf "Ignore '$targetfilepattern'\n"
svn propset svn:ignore "$svnignores" "$targetdirectory"
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Web security assessments</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> HTTP</h3>
<div class="outline-text-3" id="text-6-1">
<p>
From Hacking Exposed Web Applications:
</p>

<div class="org-src-container">

<pre class="src src-shell">#!/bin/sh
# mike's getit.sh script
if [ -z $1 ]; then
    echo -e "\n\tUsage: $0 &lt;host&gt; &lt;URL&gt;"
    exit
fi
echo -e "GET $2 HTTP/1.0\n\n" | \
nc -vv $1 80
</pre>
</div>

<div class="org-src-container">

<pre class="src src-shell">getit.sh www.missioncriticalit.com /index.html
</pre>
</div>

<div class="org-src-container">

<pre class="src src-shell">getit.sh www.victim.com /index.html | grep -i "&lt;form"
</pre>
</div>

<div class="org-src-container">

<pre class="src src-shell">getit.sh www.victim.com /index.html | grep -i "input type"
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2"><span class="section-number-3">6.2</span> HTTPS</h3>
<div class="outline-text-3" id="text-6-2">
<div class="org-src-container">

<pre class="src src-shell">#!/bin/sh
# mike's sgetit.sh script
if [ -z $1 ]; then
    echo -e "\n\tUsage: $0 &lt;SSL host&gt; &lt;URL&gt;"
    exit
fi
echo -e "GET $2 HTTP/1.0\n\n" | \
openssl s_client -quiet -connect $1:443 2&gt;/dev/null
</pre>
</div>

<div class="org-src-container">

<pre class="src src-shell">sgetit.sh www.victim.com /secure/admin.html
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Netcat</h2>
<div class="outline-text-2" id="text-7">
<p>
Here is a script which will port scan and banner grab automatically with
netcat. It will check for the SSH and MySQL version by connecting and saving
the results and it will see if the HTTP server is vulnerable to the <code>TRACE</code>
method, look in the dumpfile <code>/tmp/bannergrab</code> and look for
<code>&lt;script&gt;alert(123)&lt;/script&gt;</code> if you can find that back you got yourself a
vulnerable server.
</p>

<div class="org-src-container">

<pre class="src src-shell">#!/bin/sh

range="10.10.10.";

# You can change this to a port range $(seq 20 25) is port 20-25
ports="20 21 22 23 25 53 80 110 111 443 3306 6000";

http_header="HEAD / HTTP/0.1\n\n";

for host in $(seq 2 254); do
    for port in $ports; do
	echo "[+] Testing "$range$host":"$port;
	result=$(nc -zv -w 1 $range$host $port 2&gt;&amp;1 | grep succeeded);
	if [ -n "$result" ]; then
	    echo "\n"$range$host":"$port"\n" &gt;&gt; "/tmp/bannergrab"
	    if [ "$port" -eq "22" ]; then
		echo "Found open port "$range$host":"$port" Here might be some SSH server, it echoes the SSH version to you on connecting when lucky.";
		nc -v -w 1 $range$host $port &gt;&gt; "/tmp/bannergrab";
	    fi;
	    if [ "$port" -eq "80" ]; then
		echo "Found open port "$range$host":"$port" Trying to fingerprint with HEAD and see if the server is vulnerable to TRACE XSSing";
		echo $http_header | nc -v -w 1 $range$host $port &gt;&gt; "/tmp/bannergrab"
		echo "TRACE / HTTP/1.1\nHost: $range$host\nuser-agent: &lt;script&gt;alert(123)&lt;/script&gt;\n\n" | nc -v -w 2 $range$host $port &gt;&gt; "/tmp/bannergrab"
	    fi;
	    if [ "$port" -eq "3306" ]; then
		echo "Found open port "$range$host":"$port" Possible MySQL installation found, saving the banner for later inspection, the MySQL version can be found in this.";
		nc -v -w 1 $range$host $port &gt;&gt; "/tmp/bannergrab";
	    fi;
	fi;
    done
done
</pre>
</div>

<p>
A lot more on <a href="http://h.ackack.net/cheatsheets/netcat/">http://h.ackack.net/cheatsheets/netcat/</a>: how to workaround <code>-e
cmd.exe</code> option which disappeared, etc.
</p>
</div>

<div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1"><span class="section-number-3">7.1</span> Scan only certain ports</h3>
<div class="outline-text-3" id="text-7-1">
<div class="org-src-container">

<pre class="src src-shell">nc -z -w 1 -v -v 10.10.10.11 20-30,53,80,100-112,443,6000-6050
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2"><span class="section-number-3">7.2</span> DNS</h3>
<div class="outline-text-3" id="text-7-2">
<div class="org-src-container">

<pre class="src src-shell">nc -p 53 -w 2 -v -v firewall.yournetwork.com 53
nc -u -p 53 -w 2 -v -v firewall.yournetwork.com 53
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-3" class="outline-3">
<h3 id="sec-7-3"><span class="section-number-3">7.3</span> Spoof source IP address</h3>
<div class="outline-text-3" id="text-7-3">
<p>
<code>-s</code> option to Netcat: does not work under Cygwin&#x2026;
</p>
</div>
</div>

<div id="outline-container-sec-7-4" class="outline-3">
<h3 id="sec-7-4"><span class="section-number-3">7.4</span> Socat</h3>
<div class="outline-text-3" id="text-7-4">
<p>
Learning socat in terms of netcat: <a href="http://jdimpson.livejournal.com/6534.html">http://jdimpson.livejournal.com/6534.html</a>
</p>

<ul class="org-ul">
<li><b>Remote access server</b>

<div class="org-src-container">

<pre class="src src-shell">socat TCP-LISTEN:2323,reuseaddr EXEC:/bin/bash
</pre>
</div>
</li>

<li><b>Data forwarder</b> (aka simple proxy)

<div class="org-src-container">

<pre class="src src-shell">socat TCP-L:2323 TCP:localhost:22
</pre>
</div>

<p>
And of course, you can replace either address with any other socat address
we've already talked about (UDP, UDP-L), or ones we'll talk about in another
post (e.g. SSL).
</p>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-7-5" class="outline-3">
<h3 id="sec-7-5"><span class="section-number-3">7.5</span> Packet forger</h3>
<div class="outline-text-3" id="text-7-5">
<p>
SendIP
</p>
</div>
</div>

<div id="outline-container-sec-7-6" class="outline-3">
<h3 id="sec-7-6"><span class="section-number-3">7.6</span> Lauching attacks via Tor</h3>
<div class="outline-text-3" id="text-7-6">
<p>
<a href="http://www.oreillynet.com/onlamp/blog/2005/07/launching_attacks_via_tor.html">http://www.oreillynet.com/onlamp/blog/2005/07/launching_attacks_via_tor.html</a>
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Fabrice Niessen</p>
<p class="date">Created: 2017-08-12 Sat 11:26</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.2.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
